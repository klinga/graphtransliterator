

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>graphtransliterator.core &mdash; Graph Transliterator 1.2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Graph Transliterator
          

          
          </a>

          
            
            
              <div class="version">
                1.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bundled.html">Bundled Transliterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Tutorial: Using GraphTransliterator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced_tutorial.html">Advanced Tutorial: Bundling a Transliterator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kudos.html">Kudos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">History</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Graph Transliterator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>graphtransliterator.core</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for graphtransliterator.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">GraphTransliterator core classes.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">.ambiguity</span> <span class="kn">import</span> <span class="n">check_for_ambiguity</span>
<span class="kn">from</span> <span class="nn">.compression</span> <span class="kn">import</span> <span class="n">compress_config</span><span class="p">,</span> <span class="n">decompress_config</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">IncompleteOnMatchRulesCoverageException</span><span class="p">,</span>
    <span class="n">IncorrectVersionException</span><span class="p">,</span>
    <span class="n">NoMatchingTransliterationRuleException</span><span class="p">,</span>
    <span class="n">UnrecognizableInputTokenException</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.graphs</span> <span class="kn">import</span> <span class="n">VisitLoggingDirectedGraph</span><span class="p">,</span> <span class="n">VisitLoggingList</span>
<span class="kn">from</span> <span class="nn">.initialize</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">_graph_from</span><span class="p">,</span>
    <span class="n">_onmatch_rules_lookup</span><span class="p">,</span>
    <span class="n">_tokenizer_pattern_from</span><span class="p">,</span>
    <span class="n">_tokens_by_class_of</span><span class="p">,</span>
    <span class="n">_unescape_charnames</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.process</span> <span class="kn">import</span> <span class="n">_process_easyreading_settings</span>
<span class="kn">from</span> <span class="nn">.schemas</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DirectedGraphSchema</span><span class="p">,</span>
    <span class="n">EasyReadingSettingsSchema</span><span class="p">,</span>
    <span class="n">OnMatchRuleSchema</span><span class="p">,</span>
    <span class="n">SettingsSchema</span><span class="p">,</span>
    <span class="n">TransliterationRuleSchema</span><span class="p">,</span>
    <span class="n">WhitespaceSettingsSchema</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>

<span class="kn">from</span> <span class="nn">graphtransliterator</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">__version__</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">marshmallow</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">fields</span><span class="p">,</span>
    <span class="n">pre_load</span><span class="p">,</span>
    <span class="n">post_load</span><span class="p">,</span>
    <span class="n">Schema</span><span class="p">,</span>
    <span class="n">validates_schema</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;graphtransliterator&quot;</span><span class="p">)</span>

<span class="n">DEFAULT_COMPRESSION_LEVEL</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">HIGHEST_COMPRESSION_LEVEL</span> <span class="o">=</span> <span class="mi">2</span>


<div class="viewcode-block" id="GraphTransliteratorSchema"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliteratorSchema">[docs]</a><span class="k">class</span> <span class="nc">GraphTransliteratorSchema</span><span class="p">(</span><span class="n">Schema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Schema for Graph Transliterator.&quot;&quot;&quot;</span>

    <span class="n">tokens</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Str</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">Str</span><span class="p">()),</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Nested</span><span class="p">(</span><span class="n">TransliterationRuleSchema</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">whitespace</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Nested</span><span class="p">(</span><span class="n">WhitespaceSettingsSchema</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">onmatch_rules</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Nested</span><span class="p">(</span>
        <span class="n">OnMatchRuleSchema</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Str</span><span class="p">(),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># No restriction on values</span>
    <span class="p">)</span>
    <span class="n">ignore_errors</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">onmatch_rules_lookup</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tokens_by_class</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Str</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">fields</span><span class="o">.</span><span class="n">Str</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Nested</span><span class="p">(</span>
        <span class="n">DirectedGraphSchema</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">tokenizer_pattern</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">graphtransliterator_version</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">check_ambiguity</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># field for coverage</span>
    <span class="n">coverage</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Bool</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># compressed_settings = fields.Tuple(required=False)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordered</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@pre_load</span>
    <span class="k">def</span> <span class="nf">check_version_and_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raises error if serialized GraphTransliterator is from a later version.&quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;graphtransliterator_version&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">version</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">&gt;</span> <span class="n">__version__</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IncorrectVersionException</span>
        <span class="n">compressed_settings</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compressed_settings&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compressed_settings</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">decompress_config</span><span class="p">(</span><span class="n">compressed_settings</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">graphtransliterator_version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@post_load</span>
    <span class="k">def</span> <span class="nf">make_GraphTransliterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Convert lists to sets</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;tokens&quot;</span><span class="p">,</span> <span class="s2">&quot;tokens_by_class&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>  <span class="c1"># tokens_by_class can be generated</span>
                <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># Do not check ambiguity by default if deserializing</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;check_ambiguity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_ambiguity&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GraphTransliterator</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@validates_schema</span>
    <span class="k">def</span> <span class="nf">validate_onmatch_rules_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that if there are onmatch_rules_lookup there are onmatch_rules.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;onmatch_rules_lookup&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;onmatch_rules&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="s2">&quot;Contains onmatch_rules_lookup but not onmatch_rules.&quot;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="GraphTransliterator"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator">[docs]</a><span class="k">class</span> <span class="nc">GraphTransliterator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A graph-based transliteration tool that lets you convert the symbols</span>
<span class="sd">    of one language or script to those of another using rules that you define.</span>

<span class="sd">    Transliteration of tokens of an input string to an output string is</span>
<span class="sd">    configured by: a set of input token types with classes, pattern-matching rules</span>
<span class="sd">    involving sequences of tokens as well as preceding or following tokens and</span>
<span class="sd">    token classes, insertion rules between matches, and optional consolidation</span>
<span class="sd">    of whitespace. Rules are ordered by specificity.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    This constructor does not validate settings and should typically not be called</span>
<span class="sd">    directly. Use :meth:`from_dict` instead. For &quot;easy reading&quot; support, use</span>
<span class="sd">    :meth:`from_easyreading_dict`, :meth:`from_yaml`, or :meth:`from_yaml_file`.</span>
<span class="sd">    Keyword parameters used here (``ignore_errors``, ``check_ambiguity``) can be passed</span>
<span class="sd">    from those other constructors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tokens : `dict` of {`str`: `set` of `str`}</span>
<span class="sd">        Mapping of input token types to token classes</span>

<span class="sd">    rules : `list` of `TransliterationRule`</span>
<span class="sd">        `list` of transliteration rules ordered by cost</span>

<span class="sd">    onmatch_rules : `list` of :class:`OnMatchRule`, or `None`</span>
<span class="sd">        Rules for output to be inserted between tokens</span>
<span class="sd">        of certain classes when a transliteration rule has been matched</span>
<span class="sd">        but before its production string has been added to the output</span>

<span class="sd">    whitespace: `WhitespaceRules`</span>
<span class="sd">        Rules for handling whitespace</span>

<span class="sd">    metadata: `dict` or `None`</span>
<span class="sd">        Metadata settings</span>

<span class="sd">    ignore_errors: `bool`, optional</span>
<span class="sd">        If true, transliteration errors are ignored and do not raise an</span>
<span class="sd">        exception. The default is false.</span>

<span class="sd">    check_ambiguity: `bool`, optional</span>
<span class="sd">        If true (default), transliteration rules are checked for ambiguity. :meth:`load()`</span>
<span class="sd">        and :meth:`loads` do not check ambiguity by default.</span>

<span class="sd">    onmatch_rules_lookup: `dict` of {`str`: dict of {`str`: `list` of `int`}}, optional`</span>
<span class="sd">        OnMatchRules lookup, used internally, will be generated if not present.</span>

<span class="sd">    tokens_by_class: `dict` of {`str`: `set` of `str`}, optional</span>
<span class="sd">        Tokens by class, used internally, will be generated if not present.</span>

<span class="sd">    graph: `DirectedGraph`, optional</span>
<span class="sd">        Directed graph used by Graph Transliterator, will be generated if not present.</span>

<span class="sd">    tokenizer_pattern: `str`, optional</span>
<span class="sd">        Regular expression pattern for input string tokenization, will be generated if</span>
<span class="sd">        not present.</span>

<span class="sd">    graphtransliterator_version: `str`, optional</span>
<span class="sd">        Version of graphtransliterator, added by `dump()` and `dumps()`.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    .. jupyter-execute::</span>


<span class="sd">      from graphtransliterator import GraphTransliterator, OnMatchRule, TransliterationRule, WhitespaceRules</span>
<span class="sd">      settings = {&#39;tokens&#39;: {&#39;a&#39;: {&#39;vowel&#39;}, &#39; &#39;: {&#39;wb&#39;}}, &#39;onmatch_rules&#39;: [OnMatchRule(prev_classes=[&#39;vowel&#39;], next_classes=[&#39;vowel&#39;], production=&#39;,&#39;)], &#39;rules&#39;: [TransliterationRule(production=&#39;A&#39;, prev_classes=None, prev_tokens=None, tokens=[&#39;a&#39;], next_tokens=None, next_classes=None, cost=0.5849625007211562), TransliterationRule(production=&#39; &#39;, prev_classes=None, prev_tokens=None, tokens=[&#39; &#39;], next_tokens=None, next_classes=None, cost=0.5849625007211562)], &#39;metadata&#39;: {&#39;author&#39;: &#39;Author McAuthorson&#39;}, &#39;whitespace&#39;: WhitespaceRules(default=&#39; &#39;, token_class=&#39;wb&#39;, consolidate=False)}</span>
<span class="sd">      gt = GraphTransliterator(**settings)</span>
<span class="sd">      gt.transliterate(&#39;a&#39;)</span>


<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    from_dict : Constructor from dictionary of settings</span>
<span class="sd">    from_easyreading_dict : Constructor from  dictionary in &quot;easy reading&quot; format</span>
<span class="sd">    from_yaml : Constructor from YAML string in &quot;easy reading&quot; format</span>
<span class="sd">    from_yaml_file : Constructor from YAML file in &quot;easy reading&quot; format</span>
<span class="sd">&quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

    <span class="c1"># ---------- initialize ----------</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tokens</span><span class="p">,</span>
        <span class="n">rules</span><span class="p">,</span>
        <span class="n">whitespace</span><span class="p">,</span>
        <span class="n">onmatch_rules</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">check_ambiguity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">onmatch_rules_lookup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tokens_by_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tokenizer_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">graphtransliterator_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span> <span class="o">=</span> <span class="n">tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="n">rules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokens_by_class</span> <span class="o">=</span> <span class="n">tokens_by_class</span> <span class="ow">or</span> <span class="n">_tokens_by_class_of</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ambiguity</span> <span class="o">=</span> <span class="n">check_ambiguity</span>
        <span class="k">if</span> <span class="n">check_ambiguity</span><span class="p">:</span>
            <span class="n">check_for_ambiguity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace</span> <span class="o">=</span> <span class="n">whitespace</span>

        <span class="k">if</span> <span class="n">onmatch_rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span> <span class="o">=</span> <span class="n">onmatch_rules</span>
            <span class="k">if</span> <span class="n">onmatch_rules_lookup</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules_lookup</span> <span class="o">=</span> <span class="n">onmatch_rules_lookup</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules_lookup</span> <span class="o">=</span> <span class="n">_onmatch_rules_lookup</span><span class="p">(</span>
                    <span class="n">tokens</span><span class="p">,</span> <span class="n">onmatch_rules</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules_lookup</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span> <span class="o">=</span> <span class="n">ignore_errors</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tokenizer_pattern</span><span class="p">:</span>
            <span class="n">tokenizer_pattern</span> <span class="o">=</span> <span class="n">_tokenizer_pattern_from</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tokens</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer_pattern</span> <span class="o">=</span> <span class="n">tokenizer_pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">tokenizer_pattern</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">_graph_from</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph</span> <span class="o">=</span> <span class="n">graph</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_keys</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># last matched rules</span>

        <span class="c1"># When, or if, necessary, add version checking here</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">graphtransliterator_version</span><span class="p">:</span>
            <span class="n">graphtransliterator_version</span> <span class="o">=</span> <span class="n">__version__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphtransliterator_version</span> <span class="o">=</span> <span class="n">graphtransliterator_version</span>

    <span class="c1"># ---------- class methods ----------</span>

    <span class="c1"># ---------- private functions ----------</span>

    <span class="k">def</span> <span class="nf">_match_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_edge</span><span class="p">,</span> <span class="n">curr_node</span><span class="p">,</span> <span class="n">token_i</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Match edge constraints.</span>

<span class="sd">        Called on edge before a rule. `token_i` is set to location right</span>
<span class="sd">        after tokens consumed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="n">target_edge</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;constraints&quot;</span><span class="p">)</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">constraints</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">c_type</span><span class="p">,</span> <span class="n">c_values</span> <span class="ow">in</span> <span class="n">constraints</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">c_type</span> <span class="o">==</span> <span class="s2">&quot;prev_tokens&quot;</span><span class="p">:</span>
                <span class="n">num_tokens</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rules</span><span class="p">[</span><span class="n">curr_node</span><span class="p">[</span><span class="s2">&quot;rule_key&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
                <span class="c1"># presume for rule (a) a, with input &quot;aa&quot;</span>
                <span class="c1"># &#39; &#39;, a, a, &#39; &#39;  start (token_i=3)</span>
                <span class="c1">#             ^</span>
                <span class="c1">#         ^       -1 subtract num_tokens</span>
                <span class="c1">#      ^          - len(constraint_values)</span>
                <span class="n">start_at</span> <span class="o">=</span> <span class="n">token_i</span>
                <span class="n">start_at</span> <span class="o">-=</span> <span class="n">num_tokens</span>
                <span class="n">start_at</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c_values</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_tokens</span><span class="p">(</span>
                    <span class="n">start_at</span><span class="p">,</span>
                    <span class="n">c_values</span><span class="p">,</span>
                    <span class="n">tokens</span><span class="p">,</span>
                    <span class="n">check_prev</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">check_next</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">by_class</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">c_type</span> <span class="o">==</span> <span class="s2">&quot;next_tokens&quot;</span><span class="p">:</span>
                <span class="c1"># presume for rule a (a), with input &quot;aa&quot;</span>
                <span class="c1"># &#39; &#39;, a, a, &#39; &#39;  start (token_i=2)</span>
                <span class="c1">#         ^</span>
                <span class="n">start_at</span> <span class="o">=</span> <span class="n">token_i</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_tokens</span><span class="p">(</span>
                    <span class="n">start_at</span><span class="p">,</span>
                    <span class="n">c_values</span><span class="p">,</span>
                    <span class="n">tokens</span><span class="p">,</span>
                    <span class="n">check_prev</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">check_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">by_class</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="n">c_type</span> <span class="o">==</span> <span class="s2">&quot;prev_classes&quot;</span><span class="p">:</span>
                <span class="n">num_tokens</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rules</span><span class="p">[</span><span class="n">curr_node</span><span class="p">[</span><span class="s2">&quot;rule_key&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span>
                <span class="c1"># presume for rule (a &lt;class_a&gt;) a, with input &quot;aaa&quot;</span>
                <span class="c1"># &#39; &#39;, a, a, a, &#39; &#39;</span>
                <span class="c1">#                ^     start (token_i=4)</span>
                <span class="c1">#            ^         -num_tokens</span>
                <span class="c1">#         ^            -len(prev_tokens)</span>
                <span class="c1">#  ^                   -len(prev_classes)</span>
                <span class="n">start_at</span> <span class="o">=</span> <span class="n">token_i</span>
                <span class="n">start_at</span> <span class="o">-=</span> <span class="n">num_tokens</span>
                <span class="n">prev_tokens</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prev_tokens&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prev_tokens</span><span class="p">:</span>
                    <span class="n">start_at</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev_tokens</span><span class="p">)</span>
                <span class="n">start_at</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c_values</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_tokens</span><span class="p">(</span>
                    <span class="n">start_at</span><span class="p">,</span>
                    <span class="n">c_values</span><span class="p">,</span>
                    <span class="n">tokens</span><span class="p">,</span>
                    <span class="n">check_prev</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">check_next</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">by_class</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="n">c_type</span> <span class="o">==</span> <span class="s2">&quot;next_classes&quot;</span><span class="p">:</span>
                <span class="c1"># presume for rule a (a &lt;class_a&gt;), with input &quot;aaa&quot;</span>
                <span class="c1"># &#39; &#39;, a, a, a, &#39; &#39;</span>
                <span class="c1">#         ^          start (token_i=2)</span>
                <span class="c1">#            ^       + len of next_tokens (a)</span>
                <span class="n">start_at</span> <span class="o">=</span> <span class="n">token_i</span>
                <span class="n">next_tokens</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;next_tokens&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">next_tokens</span><span class="p">:</span>
                    <span class="n">start_at</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_tokens</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_tokens</span><span class="p">(</span>
                    <span class="n">start_at</span><span class="p">,</span>
                    <span class="n">c_values</span><span class="p">,</span>
                    <span class="n">tokens</span><span class="p">,</span>
                    <span class="n">check_prev</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">check_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">by_class</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_match_tokens</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start_i</span><span class="p">,</span>
        <span class="n">constraint_values</span><span class="p">,</span>
        <span class="n">tokens</span><span class="p">,</span>
        <span class="n">check_prev</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">check_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">by_class</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Match tokens at a particular index, optionally checking previous or next tokens</span>
<span class="sd">        and by token class, with boundary checks.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">check_prev</span> <span class="ow">and</span> <span class="n">start_i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">check_next</span> <span class="ow">and</span> <span class="n">start_i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraint_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraint_values</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">by_class</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">constraint_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span><span class="p">[</span><span class="n">tokens</span><span class="p">[</span><span class="n">start_i</span> <span class="o">+</span> <span class="n">i</span><span class="p">]]:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">tokens</span><span class="p">[</span><span class="n">start_i</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">constraint_values</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># ---------- properties ----------</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`DirectedGraph`: Graph used in transliteration.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">graphtransliterator_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`str`: Graph Transliterator version.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphtransliterator_version</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ignore_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`bool`: Ignore transliteration errors setting.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span>

    <span class="nd">@ignore_errors</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">ignore_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_input_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `list` of `str`: Last tokenization of the input string, with whitespace</span>
<span class="sd">        at start and end.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_tokens</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_matched_rule_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`list` of `list` of `str`: Last matched tokens for each rule.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">tokens</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_keys</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_matched_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `list` of `TransliterationRule`: Last transliteration rules matched.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_keys</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `dict`: Metadata of transliterator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">onmatch_rules_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `dict`: On Match Rules lookup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules_lookup</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tokenizer_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `str`: Tokenizer pattern from transliterator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer_pattern</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tokens_by_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `dict` of {`str`: `list` of `str`}: Tokenizer pattern from transliterator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens_by_class</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">onmatch_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;`list` of :class:`OnMatchRules`: Rules for productions between matches.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">productions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `list` of `str`: List of productions of each transliteration rule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">production</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `list` of `TransliterationRule`: Transliteration rules sorted by cost.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `dict` of {`str`:`set` of `str`}: Mappings of tokens to their classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">whitespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;WhiteSpaceRules: Whitespace rules.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace</span>

    <span class="c1"># ---------- public functions ----------</span>

<div class="viewcode-block" id="GraphTransliterator.dump"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compression_level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dump configuration of Graph Transliterator to Python data types.</span>

<span class="sd">        Compression is turned off by default.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        compression_level: `int`</span>
<span class="sd">            A value in 0 (default, no compression), 1 (compression including graph),</span>
<span class="sd">            and 2 (compressiong without graph)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict</span>
<span class="sd">            GraphTransliterator configuration as a dictionary with keys:</span>

<span class="sd">                ``&quot;tokens&quot;``</span>
<span class="sd">                  Mappings of tokens to their classes</span>
<span class="sd">                  (`OrderedDict` of {str: `list` of `str`})</span>

<span class="sd">                ``&quot;rules&quot;``</span>
<span class="sd">                  Transliteration rules in direct format</span>
<span class="sd">                  (`list` of `dict` of {`str`: `str`})</span>

<span class="sd">                ``&quot;whitespace&quot;``</span>
<span class="sd">                  Whitespace settings</span>
<span class="sd">                  (`dict` of {`str`: `str`})</span>

<span class="sd">                ``&quot;onmatch_rules&quot;``</span>
<span class="sd">                  On match rules</span>
<span class="sd">                  (`list` of `OrderedDict`)</span>

<span class="sd">                ``&quot;metadata&quot;``</span>
<span class="sd">                  Dictionary of metadata (`dict`)</span>

<span class="sd">                ``&quot;ignore_errors&quot;``</span>
<span class="sd">                  Ignore errors in transliteration (`bool`)</span>

<span class="sd">                ``&quot;onmatch_rules_lookup&quot;``</span>
<span class="sd">                  Dictionary keyed by current token to previous token</span>
<span class="sd">                  containing a list of indexes of applicable :class:`OnmatchRule`</span>
<span class="sd">                  to try</span>
<span class="sd">                  (`dict` of {`str`: `dict` of {`str`: `list` of `int`}})</span>

<span class="sd">                ``&quot;tokens_by_class&quot;``</span>
<span class="sd">                  Tokens keyed by token class, used internally</span>
<span class="sd">                  (`dict` of {`str`: `list` of str})</span>

<span class="sd">                ``&quot;graph&quot;``</span>
<span class="sd">                  Serialization of `DirectedGraph`</span>
<span class="sd">                  (`dict`)</span>

<span class="sd">                ``&quot;tokenizer_pattern&quot;``</span>
<span class="sd">                  Regular expression for tokenizing</span>
<span class="sd">                  (`str`)</span>

<span class="sd">                ``&quot;graphtransliterator_version&quot;``</span>
<span class="sd">                  Module version of `graphtransliterator` (`str`)</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          yaml_ = &#39;&#39;&#39;</span>
<span class="sd">          tokens:</span>
<span class="sd">            a: [vowel]</span>
<span class="sd">            &#39; &#39;: [wb]</span>
<span class="sd">          rules:</span>
<span class="sd">            a: A</span>
<span class="sd">            &#39; &#39;: &#39; &#39;</span>
<span class="sd">          whitespace:</span>
<span class="sd">            default: &quot; &quot;</span>
<span class="sd">            consolidate: false</span>
<span class="sd">            token_class: wb</span>
<span class="sd">          onmatch_rules:</span>
<span class="sd">            - &lt;vowel&gt; + &lt;vowel&gt;: &#39;,&#39;  # add a comma between vowels</span>
<span class="sd">          metadata:</span>
<span class="sd">            author: &quot;Author McAuthorson&quot;</span>
<span class="sd">          &#39;&#39;&#39;</span>
<span class="sd">          gt = GraphTransliterator.from_yaml(yaml_)</span>
<span class="sd">          gt.dump()</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dumps : Dump Graph Transliterator configuration to JSON string</span>
<span class="sd">        load : Load Graph Transliteration from configuration in Python data types</span>
<span class="sd">        loads : Load Graph Transliteration from configuration as a JSON string</span>

<span class="sd">&quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="k">if</span> <span class="n">compression_level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GraphTransliteratorSchema</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">compression_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">HIGHEST_COMPRESSION_LEVEL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Compression level must be between 0 and </span><span class="si">{HIGHEST_COMPRESSION_LEVEL}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;graphtransliterator_version&quot;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
            <span class="s2">&quot;compressed_settings&quot;</span><span class="p">:</span> <span class="n">compress_config</span><span class="p">(</span>
                <span class="n">GraphTransliteratorSchema</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                <span class="n">compression_level</span><span class="o">=</span><span class="n">compression_level</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="GraphTransliterator.dumps"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.dumps">[docs]</a>    <span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compression_level</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        compression_level: `int`</span>
<span class="sd">            A value in 0 (no compression), 1 (compression including graph),</span>
<span class="sd">            and 2 (default, compression without graph)</span>
<span class="sd">        separators: `tuple` of `str`</span>
<span class="sd">            Separators used by json.dumps(), default is compact</span>

<span class="sd">        Dump settings of Graph Transliterator to Javascript Object Notation (JSON).</span>

<span class="sd">        Compression is turned on by default.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `str`</span>
<span class="sd">            JSON string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          yaml_ = &#39;&#39;&#39;</span>
<span class="sd">            tokens:</span>
<span class="sd">              a: [vowel]</span>
<span class="sd">              &#39; &#39;: [wb]</span>
<span class="sd">            rules:</span>
<span class="sd">              a: A</span>
<span class="sd">              &#39; &#39;: &#39; &#39;</span>
<span class="sd">            whitespace:</span>
<span class="sd">              default: &quot; &quot;</span>
<span class="sd">              consolidate: false</span>
<span class="sd">              token_class: wb</span>
<span class="sd">            onmatch_rules:</span>
<span class="sd">              - &lt;vowel&gt; + &lt;vowel&gt;: &#39;,&#39;  # add a comma between vowels</span>
<span class="sd">            metadata:</span>
<span class="sd">              author: &quot;Author McAuthorson&quot;</span>
<span class="sd">          &#39;&#39;&#39;</span>
<span class="sd">          gt = GraphTransliterator.from_yaml(yaml_)</span>
<span class="sd">          gt.dumps()</span>



<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dump : Dump Graph Transliterator configuration to Python data types</span>
<span class="sd">        load : Load Graph Transliteration from configuration in Python data types</span>
<span class="sd">        loads : Load Graph Transliteration from configuration as a JSON string</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="k">if</span> <span class="n">compression_level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GraphTransliteratorSchema</span><span class="p">()</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">compression_level</span><span class="o">=</span><span class="n">compression_level</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_config</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="GraphTransliterator.match_at"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.match_at">[docs]</a>    <span class="k">def</span> <span class="nf">match_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token_i</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="n">match_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Match best (least costly) transliteration rule at a given index in the</span>
<span class="sd">        input tokens and return the index to  that rule. Optionally, return all</span>
<span class="sd">        rules that match.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        token_i : `int`</span>
<span class="sd">            Location in `tokens` at which to begin</span>
<span class="sd">        tokens : `list` of `str`</span>
<span class="sd">            List of tokens</span>
<span class="sd">        match_all : `bool`, optional</span>
<span class="sd">            If true, return the index of all rules matching at the given</span>
<span class="sd">            index. The default is false.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `int`, `None`, or `list` of `int`</span>
<span class="sd">            Index of matching transliteration rule in</span>
<span class="sd">            :attr:`GraphTransliterator.rules` or None. Returns a `list` of</span>
<span class="sd">            `int` or an empty `list` if ``match_all`` is true.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Expects whitespaces token at beginning and end of `tokens`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          gt = GraphTransliterator.from_yaml(&#39;&#39;&#39;</span>
<span class="sd">                  tokens:</span>
<span class="sd">                      a: []</span>
<span class="sd">                      a a: []</span>
<span class="sd">                      &#39; &#39;: [wb]</span>
<span class="sd">                  rules:</span>
<span class="sd">                      a: &lt;A&gt;</span>
<span class="sd">                      a a: &lt;AA&gt;</span>
<span class="sd">                  whitespace:</span>
<span class="sd">                      default: &#39; &#39;</span>
<span class="sd">                      consolidate: True</span>
<span class="sd">                      token_class: wb</span>
<span class="sd">          &#39;&#39;&#39;)</span>
<span class="sd">          tokens = gt.tokenize(&quot;aa&quot;)</span>
<span class="sd">          tokens # whitespace added to ends</span>

<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          gt.match_at(1, tokens) # returns index to rule</span>

<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          gt.rules[gt.match_at(1, tokens)] # actual rule</span>

<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          gt.match_at(1, tokens, match_all=True) # index to rules, with match_all</span>

<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          [gt.rules[_] for _ in gt.match_at(1, tokens, match_all=True)]</span>

<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph</span>
        <span class="n">graph_node</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">node</span>
        <span class="n">graph_edge</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">edge</span>
        <span class="k">if</span> <span class="n">match_all</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">_append_children</span><span class="p">(</span><span class="n">node_key</span><span class="p">,</span> <span class="n">token_i</span><span class="p">):</span>
            <span class="n">children</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ordered_children</span> <span class="o">=</span> <span class="n">graph_node</span><span class="p">[</span><span class="n">node_key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ordered_children&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ordered_children</span><span class="p">:</span>
                <span class="n">children</span> <span class="o">=</span> <span class="n">ordered_children</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">token_i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
                    <span class="c1"># reordered high to low for stack:</span>
                    <span class="k">for</span> <span class="n">child_key</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">children</span><span class="p">):</span>

                        <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">((</span><span class="n">child_key</span><span class="p">,</span> <span class="n">node_key</span><span class="p">,</span> <span class="n">token_i</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rules_keys</span> <span class="o">=</span> <span class="n">ordered_children</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__rules__&quot;</span><span class="p">)</span>  <span class="c1"># leafs</span>
                    <span class="k">if</span> <span class="n">rules_keys</span><span class="p">:</span>
                        <span class="c1"># There may be more than one rule, as certain rules have</span>
                        <span class="c1"># constraints on them.</span>
                        <span class="c1"># Reordered so higher cost go on stack last.</span>
                        <span class="k">for</span> <span class="n">rule_key</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">rules_keys</span><span class="p">):</span>
                            <span class="n">stack</span><span class="o">.</span><span class="n">appendleft</span><span class="p">((</span><span class="n">rule_key</span><span class="p">,</span> <span class="n">node_key</span><span class="p">,</span> <span class="n">token_i</span><span class="p">))</span>

        <span class="n">_append_children</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">token_i</span><span class="p">)</span>  <span class="c1"># Append all children of root node</span>

        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>  <span class="c1"># LIFO</span>
            <span class="n">node_key</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">,</span> <span class="n">token_i</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>

            <span class="n">curr_node</span> <span class="o">=</span> <span class="n">graph_node</span><span class="p">[</span><span class="n">node_key</span><span class="p">]</span>
            <span class="c1"># Constraints are only on preceding edge if it is accepting</span>
            <span class="c1"># But edge is accessed regardless to test coverage</span>
            <span class="n">incident_edge</span> <span class="o">=</span> <span class="n">graph_edge</span><span class="p">[</span><span class="n">parent_key</span><span class="p">][</span><span class="n">node_key</span><span class="p">]</span>
            <span class="c1"># Pass edge, curr_node, token index, and tokens to check constraints</span>
            <span class="k">if</span> <span class="n">curr_node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;accepting&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_constraints</span><span class="p">(</span>
                <span class="n">incident_edge</span><span class="p">,</span> <span class="n">curr_node</span><span class="p">,</span> <span class="n">token_i</span><span class="p">,</span> <span class="n">tokens</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">match_all</span><span class="p">:</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_node</span><span class="p">[</span><span class="s2">&quot;rule_key&quot;</span><span class="p">])</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">curr_node</span><span class="p">[</span><span class="s2">&quot;rule_key&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">token_i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">token_i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">_append_children</span><span class="p">(</span><span class="n">node_key</span><span class="p">,</span> <span class="n">token_i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match_all</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matches</span></div>

<div class="viewcode-block" id="GraphTransliterator.pruned_of"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.pruned_of">[docs]</a>    <span class="k">def</span> <span class="nf">pruned_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">productions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove transliteration rules with specific output productions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        productions : `str`, or `list` of `str`</span>
<span class="sd">            list of productions to remove</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        graphtransliterator.GraphTransliterator</span>
<span class="sd">            Graph transliterator pruned of certain productions.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Uses original initialization parameters to construct a new</span>
<span class="sd">        :class:`GraphTransliterator`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          gt = GraphTransliterator.from_yaml(&#39;&#39;&#39;</span>
<span class="sd">                  tokens:</span>
<span class="sd">                      a: []</span>
<span class="sd">                      a a: []</span>
<span class="sd">                      &#39; &#39;: [wb]</span>
<span class="sd">                  rules:</span>
<span class="sd">                      a: &lt;A&gt;</span>
<span class="sd">                      a a: &lt;AA&gt;</span>
<span class="sd">                  whitespace:</span>
<span class="sd">                      default: &#39; &#39;</span>
<span class="sd">                      consolidate: True</span>
<span class="sd">                      token_class: wb</span>
<span class="sd">          &#39;&#39;&#39;)</span>
<span class="sd">          gt.rules</span>

<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          gt.pruned_of(&#39;&lt;AA&gt;&#39;).rules</span>

<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          gt.pruned_of([&#39;&lt;A&gt;&#39;, &#39;&lt;AA&gt;&#39;]).rules</span>

<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="n">pruned_rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="k">if</span> <span class="n">_</span><span class="o">.</span><span class="n">production</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">productions</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">GraphTransliterator</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tokens</span><span class="p">,</span>
            <span class="n">pruned_rules</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace</span><span class="p">,</span>
            <span class="n">onmatch_rules</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">,</span>
            <span class="n">ignore_errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ignore_errors</span><span class="p">,</span>
            <span class="n">check_ambiguity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_ambiguity</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="GraphTransliterator.tokenize"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.tokenize">[docs]</a>    <span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tokenizes an input string.</span>

<span class="sd">        Adds initial and trailing whitespace, which can be consolidated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input : str</span>
<span class="sd">            String to tokenize</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `list` of `str`</span>
<span class="sd">            List of tokens, with default whitespace token at beginning and end.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Unrecognizable input, such as a character that is not in a token</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          tokens = {&#39;ab&#39;: [&#39;class_ab&#39;], &#39; &#39;: [&#39;wb&#39;]}</span>
<span class="sd">          whitespace = {&#39;default&#39;: &#39; &#39;, &#39;token_class&#39;: &#39;wb&#39;, &#39;consolidate&#39;: True}</span>
<span class="sd">          rules = {&#39;ab&#39;: &#39;AB&#39;, &#39; &#39;: &#39;_&#39;}</span>
<span class="sd">          settings = {&#39;tokens&#39;: tokens, &#39;rules&#39;: rules, &#39;whitespace&#39;: whitespace}</span>
<span class="sd">          gt = GraphTransliterator.from_easyreading_dict(settings)</span>
<span class="sd">          gt.tokenize(&#39;ab &#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">is_whitespace</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Check if token is whitespace.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">whitespace</span><span class="o">.</span><span class="n">token_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">[</span><span class="n">token</span><span class="p">]</span>

        <span class="c1"># start with a whitespace token</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">whitespace</span><span class="o">.</span><span class="n">default</span><span class="p">]</span>

        <span class="n">prev_whitespace</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">match_at</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">match_at</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">match_at</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">match_at</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>  <span class="c1"># advance match_at</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># Could save match loc here:</span>
                <span class="c1"># matched_at = match.span(0)[0]</span>
                <span class="k">if</span> <span class="n">is_whitespace</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">prev_whitespace</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">whitespace</span><span class="o">.</span><span class="n">consolidate</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">prev_whitespace</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">prev_whitespace</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Unrecognizable token </span><span class="si">%s</span><span class="s2"> at pos </span><span class="si">%s</span><span class="s2"> of </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="n">match_at</span><span class="p">],</span> <span class="n">match_at</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">UnrecognizableInputTokenException</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">match_at</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">whitespace</span><span class="o">.</span><span class="n">consolidate</span><span class="p">:</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">is_whitespace</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">tokens</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">whitespace</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tokens</span></div>

<div class="viewcode-block" id="GraphTransliterator.transliterate"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.transliterate">[docs]</a>    <span class="k">def</span> <span class="nf">transliterate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transliterate an input string into an output string.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input : `str`</span>
<span class="sd">            Input string to transliterate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `str`</span>
<span class="sd">            Transliteration output string</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Cannot parse input</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Whitespace will be temporarily appended to start and end of input</span>
<span class="sd">        string.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          GraphTransliterator.from_yaml(</span>
<span class="sd">          &#39;&#39;&#39;</span>
<span class="sd">          tokens:</span>
<span class="sd">            a: []</span>
<span class="sd">            &#39; &#39;: [wb]</span>
<span class="sd">          rules:</span>
<span class="sd">            a: A</span>
<span class="sd">            &#39; &#39;: &#39;_&#39;</span>
<span class="sd">          whitespace:</span>
<span class="sd">            default: &#39; &#39;</span>
<span class="sd">            consolidate: True</span>
<span class="sd">            token_class: wb</span>
<span class="sd">          &#39;&#39;&#39;).transliterate(&quot;a a&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>  <span class="c1"># Adds initial+final whitespace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_tokens</span> <span class="o">=</span> <span class="n">tokens</span>  <span class="c1"># Tokens are saved here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_keys</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Matched ule keys are saved here</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">token_i</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Adjust for initial whitespace</span>

        <span class="k">while</span> <span class="n">token_i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Adjust for final whitespace</span>
            <span class="n">rule_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_at</span><span class="p">(</span><span class="n">token_i</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rule_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No matching transliteration rule at token pos </span><span class="si">%s</span><span class="s2"> of </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">token_i</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># No parsing rule was found at this location</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_errors</span><span class="p">:</span>
                    <span class="c1"># Move along if ignoring errors</span>
                    <span class="n">token_i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">NoMatchingTransliterationRuleException</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rule_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule_key</span><span class="p">)</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">rule_key</span><span class="p">]</span>
            <span class="n">tokens_matched</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">tokens</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span><span class="p">:</span>
                <span class="n">curr_match_rules</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">prev_t</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">token_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">curr_t</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">token_i</span><span class="p">]</span>
                <span class="n">curr_t_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules_lookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_t</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">curr_t_rules</span><span class="p">:</span>
                    <span class="n">curr_match_rules</span> <span class="o">=</span> <span class="n">curr_t_rules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prev_t</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">curr_match_rules</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">onmatch_i</span> <span class="ow">in</span> <span class="n">curr_match_rules</span><span class="p">:</span>
                        <span class="n">onmatch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span><span class="p">[</span><span class="n">onmatch_i</span><span class="p">]</span>
                        <span class="c1"># &lt;class_a&gt; &lt;class_a&gt; + &lt;class_b&gt;</span>
                        <span class="c1"># a a b</span>
                        <span class="c1">#     ^</span>
                        <span class="c1"># ^      - len(onmatch.prev_rules)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_tokens</span><span class="p">(</span>
                            <span class="n">token_i</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">onmatch</span><span class="o">.</span><span class="n">prev_classes</span><span class="p">),</span>
                            <span class="n">onmatch</span><span class="o">.</span><span class="n">prev_classes</span><span class="p">,</span>  <span class="c1"># Checks last value</span>
                            <span class="n">tokens</span><span class="p">,</span>
                            <span class="n">check_prev</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">check_next</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">by_class</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_tokens</span><span class="p">(</span>
                            <span class="n">token_i</span><span class="p">,</span>
                            <span class="n">onmatch</span><span class="o">.</span><span class="n">next_classes</span><span class="p">,</span>  <span class="c1"># Checks first value</span>
                            <span class="n">tokens</span><span class="p">,</span>
                            <span class="n">check_prev</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">check_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">by_class</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="p">):</span>
                            <span class="n">output</span> <span class="o">+=</span> <span class="n">onmatch</span><span class="o">.</span><span class="n">production</span>
                            <span class="k">break</span>  <span class="c1"># Only match best onmatch rule</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="n">rule</span><span class="o">.</span><span class="n">production</span>
            <span class="n">token_i</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens_matched</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>

    <span class="c1"># ---------- static methods ----------</span>

<div class="viewcode-block" id="GraphTransliterator.from_dict"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.from_dict">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">dict_settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate GraphTransliterator from `dict` settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dict_settings : `dict`</span>
<span class="sd">            Dictionary of settings</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GraphTransliterator</span>
<span class="sd">            Graph transliterator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">SettingsSchema</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dict_settings</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;tokens&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;rules&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;whitespace&quot;</span><span class="p">]]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;onmatch_rules&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;onmatch_rules&quot;</span><span class="p">),</span>
            <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">),</span>
            <span class="s2">&quot;tokens_by_class&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tokens_by_class&quot;</span><span class="p">),</span>  <span class="c1"># will be generated</span>
            <span class="s2">&quot;graph&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">),</span>  <span class="c1"># will be generated</span>
            <span class="s2">&quot;tokenizer_pattern&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tokenizer_pattern&quot;</span><span class="p">),</span>  <span class="c1"># will be generated</span>
            <span class="s2">&quot;ignore_errors&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ignore_errors&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="s2">&quot;check_ambiguity&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_ambiguity&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">GraphTransliterator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GraphTransliterator.from_easyreading_dict"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.from_easyreading_dict">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_easyreading_dict</span><span class="p">(</span><span class="n">easyreading_settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs `GraphTransliterator` from a dictionary of settings in</span>
<span class="sd">        &quot;easy reading&quot; format, i.e. the loaded contents of a YAML string.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        easyreading_settings : `dict`</span>
<span class="sd">            Settings dictionary in easy reading format with keys:</span>

<span class="sd">                ``&quot;tokens&quot;``</span>
<span class="sd">                  Mappings of tokens to their classes</span>
<span class="sd">                  (`dict` of {str: `list` of `str`})</span>

<span class="sd">                ``&quot;rules&quot;``</span>
<span class="sd">                  Transliteration rules in &quot;easy reading&quot; format</span>
<span class="sd">                  (`list` of `dict` of {`str`: `str`})</span>

<span class="sd">                ``&quot;onmatch_rules&quot;``</span>
<span class="sd">                  On match rules in &quot;easy reading&quot; format</span>
<span class="sd">                  (`dict` of {`str`: `str`}, optional)</span>

<span class="sd">                ``&quot;whitespace&quot;``</span>
<span class="sd">                  Whitespace definitions, including default whitespace token,</span>
<span class="sd">                  class of whitespace tokens, and whether or not to consolidate</span>
<span class="sd">                  (`dict` of {&#39;default&#39;: `str`, &#39;token_class&#39;: `str`,</span>
<span class="sd">                  consolidate: `bool`}, optional)</span>

<span class="sd">                ``&quot;metadata&quot;``</span>
<span class="sd">                  Dictionary of metadata (`dict`, optional)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GraphTransliterator</span>
<span class="sd">            Graph Transliterator</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Called by :meth:`from_yaml`.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          tokens = {</span>
<span class="sd">              &#39;ab&#39;: [&#39;class_ab&#39;],</span>
<span class="sd">              &#39; &#39;: [&#39;wb&#39;]</span>
<span class="sd">          }</span>
<span class="sd">          whitespace = {</span>
<span class="sd">              &#39;default&#39;: &#39; &#39;,</span>
<span class="sd">              &#39;token_class&#39;: &#39;wb&#39;,</span>
<span class="sd">              &#39;consolidate&#39;: True</span>
<span class="sd">          }</span>
<span class="sd">          onmatch_rules = [</span>
<span class="sd">              {&#39;&lt;class_ab&gt; + &lt;class_ab&gt;&#39;: &#39;,&#39;}</span>
<span class="sd">          ]</span>
<span class="sd">          rules = {&#39;ab&#39;: &#39;AB&#39;,</span>
<span class="sd">                   &#39; &#39;: &#39;_&#39;}</span>
<span class="sd">          settings = {&#39;tokens&#39;: tokens,</span>
<span class="sd">                      &#39;rules&#39;: rules,</span>
<span class="sd">                      &#39;whitespace&#39;: whitespace,</span>
<span class="sd">                      &#39;onmatch_rules&#39;: onmatch_rules}</span>
<span class="sd">          gt = GraphTransliterator.from_easyreading_dict(settings)</span>
<span class="sd">          gt.transliterate(&quot;ab abab&quot;)</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        from_yaml : Constructor from YAML string in &quot;easy reading&quot; format</span>
<span class="sd">        from_yaml_file : Constructor from YAML file in &quot;easy reading&quot; format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate easyreading settings</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">EasyReadingSettingsSchema</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">easyreading_settings</span><span class="p">)</span>
        <span class="c1"># Convert those to regular settings</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">_process_easyreading_settings</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
        <span class="c1"># Validation of regular settings is done in from_dict</span>
        <span class="k">return</span> <span class="n">GraphTransliterator</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GraphTransliterator.from_yaml"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.from_yaml">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_yaml</span><span class="p">(</span><span class="n">yaml_str</span><span class="p">,</span> <span class="n">charnames_escaped</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct GraphTransliterator from a YAML str.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yaml_str : str</span>
<span class="sd">            YAML mappings of tokens, rules, and (optionally) onmatch_rules</span>
<span class="sd">        charnames_escaped : boolean</span>
<span class="sd">            Unescape Unicode during YAML read (default True)</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Called by :meth:`from_yaml_file` and calls :meth:`from_easyreading_dict`.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          yaml_ = &#39;&#39;&#39;</span>
<span class="sd">          tokens:</span>
<span class="sd">            a: [class1]</span>
<span class="sd">            &#39; &#39;: [wb]</span>
<span class="sd">          rules:</span>
<span class="sd">            a: A</span>
<span class="sd">            &#39; &#39;: &#39; &#39;</span>
<span class="sd">          whitespace:</span>
<span class="sd">            default: &#39; &#39;</span>
<span class="sd">            consolidate: True</span>
<span class="sd">            token_class: wb</span>
<span class="sd">          onmatch_rules:</span>
<span class="sd">            - &lt;class1&gt; + &lt;class1&gt;: &quot;+&quot;</span>
<span class="sd">          &#39;&#39;&#39;</span>
<span class="sd">          gt = GraphTransliterator.from_yaml(yaml_)</span>
<span class="sd">          gt.transliterate(&quot;a aa&quot;)</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        from_easyreading_dict : Constructor from dictionary in &quot;easy reading&quot; format</span>
<span class="sd">        from_yaml : Constructor from YAML string in &quot;easy reading&quot; format</span>
<span class="sd">        from_yaml_file : Constructor from YAML file in &quot;easy reading&quot; format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">charnames_escaped</span><span class="p">:</span>
            <span class="n">yaml_str</span> <span class="o">=</span> <span class="n">_unescape_charnames</span><span class="p">(</span><span class="n">yaml_str</span><span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yaml_str</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">GraphTransliterator</span><span class="o">.</span><span class="n">from_easyreading_dict</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GraphTransliterator.from_yaml_file"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.from_yaml_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_yaml_file</span><span class="p">(</span><span class="n">yaml_filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct GraphTransliterator from YAML file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yaml_filename : str</span>
<span class="sd">            Name of YAML file, containing tokens, rules, and (optionally)</span>
<span class="sd">            onmatch_rules</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Calls :meth:`from_yaml`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        from_yaml : Constructor from YAML string in &quot;easy reading&quot; format</span>
<span class="sd">        from_easyreading_dict : Constructor from dictionary in &quot;easy reading&quot; format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yaml_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml_string</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">GraphTransliterator</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="n">yaml_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GraphTransliterator.load"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.load">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create GraphTransliterator from settings as Python data types.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        settings</span>
<span class="sd">            GraphTransliterator configuration as a dictionary with keys:</span>

<span class="sd">                ``&quot;tokens&quot;``</span>
<span class="sd">                  Mappings of tokens to their classes</span>
<span class="sd">                  (`dict` of {str: `list` of `str`})</span>

<span class="sd">                ``&quot;rules&quot;``</span>
<span class="sd">                  Transliteration rules in direct format</span>
<span class="sd">                  (`list` of `OrderedDict` of {`str`: `str`})</span>

<span class="sd">                ``&quot;whitespace&quot;``</span>
<span class="sd">                  Whitespace settings</span>
<span class="sd">                  (`dict` of {`str`: `str`})</span>

<span class="sd">                ``&quot;onmatch_rules&quot;``</span>
<span class="sd">                  On match rules</span>
<span class="sd">                  (`list` of `OrderedDict`, optional)</span>

<span class="sd">                ``&quot;metadata&quot;``</span>
<span class="sd">                  Dictionary of metadata (`dict`, optional)</span>

<span class="sd">                ``&quot;ignore_errors&quot;``</span>
<span class="sd">                  Ignore errors. (`bool`, optional)</span>

<span class="sd">                ``&quot;onmatch_rules_lookup&quot;``</span>
<span class="sd">                  Dictionary keyed by current token to previous token</span>
<span class="sd">                  containing a list of indexes of applicable :class:`OnmatchRule`</span>
<span class="sd">                  to try</span>
<span class="sd">                  (`dict` of {`str`: `dict` of {`str`: `list` of `int`}}, optional)</span>

<span class="sd">                ``tokens_by_class``</span>
<span class="sd">                  Tokens keyed by token class, used internally</span>
<span class="sd">                  (`dict` of {`str`: `list` of str}, optional)</span>

<span class="sd">                ``graph``</span>
<span class="sd">                  Serialization of `DirectedGraph`</span>
<span class="sd">                  (`dict`, optional)</span>

<span class="sd">                ``&quot;tokenizer_pattern&quot;``</span>
<span class="sd">                  Regular expression for tokenizing</span>
<span class="sd">                  (`str`, optional)</span>

<span class="sd">                ``&quot;graphtransliterator_version&quot;``</span>
<span class="sd">                  Module version of `graphtransliterator` (`str`, optional)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GraphTransliterator</span>
<span class="sd">            Graph Transliterator</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          from collections import OrderedDict</span>
<span class="sd">          settings = \</span>
<span class="sd">          {&#39;tokens&#39;: {&#39;a&#39;: [&#39;vowel&#39;], &#39; &#39;: [&#39;wb&#39;]},</span>
<span class="sd">           &#39;rules&#39;: [OrderedDict([(&#39;production&#39;, &#39;A&#39;),</span>
<span class="sd">                         # Can be compacted, removing None values</span>
<span class="sd">                         # (&#39;prev_tokens&#39;, None),</span>
<span class="sd">                         (&#39;tokens&#39;, [&#39;a&#39;]),</span>
<span class="sd">                         (&#39;next_classes&#39;, None),</span>
<span class="sd">                         (&#39;next_tokens&#39;, None),</span>
<span class="sd">                         (&#39;cost&#39;, 0.5849625007211562)]),</span>
<span class="sd">            OrderedDict([(&#39;production&#39;, &#39; &#39;),</span>
<span class="sd">                         (&#39;prev_classes&#39;, None),</span>
<span class="sd">                         (&#39;prev_tokens&#39;, None),</span>
<span class="sd">                         (&#39;tokens&#39;, [&#39; &#39;]),</span>
<span class="sd">                         (&#39;next_classes&#39;, None),</span>
<span class="sd">                         (&#39;next_tokens&#39;, None),</span>
<span class="sd">                         (&#39;cost&#39;, 0.5849625007211562)])],</span>
<span class="sd">           &#39;whitespace&#39;: {&#39;default&#39;: &#39; &#39;, &#39;token_class&#39;: &#39;wb&#39;, &#39;consolidate&#39;: False},</span>
<span class="sd">           &#39;onmatch_rules&#39;: [OrderedDict([(&#39;prev_classes&#39;, [&#39;vowel&#39;]),</span>
<span class="sd">                         (&#39;next_classes&#39;, [&#39;vowel&#39;]),</span>
<span class="sd">                         (&#39;production&#39;, &#39;,&#39;)])],</span>
<span class="sd">           &#39;metadata&#39;: {&#39;author&#39;: &#39;Author McAuthorson&#39;},</span>
<span class="sd">           &#39;onmatch_rules_lookup&#39;: {&#39;a&#39;: {&#39;a&#39;: [0]}},</span>
<span class="sd">           &#39;tokens_by_class&#39;: {&#39;vowel&#39;: [&#39;a&#39;], &#39;wb&#39;: [&#39; &#39;]},</span>
<span class="sd">           &#39;graph&#39;: {&#39;edge&#39;: {0: {1: {&#39;token&#39;: &#39;a&#39;, &#39;cost&#39;: 0.5849625007211562},</span>
<span class="sd">              3: {&#39;token&#39;: &#39; &#39;, &#39;cost&#39;: 0.5849625007211562}},</span>
<span class="sd">             1: {2: {&#39;cost&#39;: 0.5849625007211562}},</span>
<span class="sd">             3: {4: {&#39;cost&#39;: 0.5849625007211562}}},</span>
<span class="sd">            &#39;node&#39;: [{&#39;type&#39;: &#39;Start&#39;, &#39;ordered_children&#39;: {&#39;a&#39;: [1], &#39; &#39;: [3]}},</span>
<span class="sd">             {&#39;type&#39;: &#39;token&#39;, &#39;token&#39;: &#39;a&#39;, &#39;ordered_children&#39;: {&#39;__rules__&#39;: [2]}},</span>
<span class="sd">             {&#39;type&#39;: &#39;rule&#39;,</span>
<span class="sd">              &#39;rule_key&#39;: 0,</span>
<span class="sd">              &#39;accepting&#39;: True,</span>
<span class="sd">              &#39;ordered_children&#39;: {}},</span>
<span class="sd">             {&#39;type&#39;: &#39;token&#39;, &#39;token&#39;: &#39; &#39;, &#39;ordered_children&#39;: {&#39;__rules__&#39;: [4]}},</span>
<span class="sd">             {&#39;type&#39;: &#39;rule&#39;,</span>
<span class="sd">              &#39;rule_key&#39;: 1,</span>
<span class="sd">              &#39;accepting&#39;: True,</span>
<span class="sd">              &#39;ordered_children&#39;: {}}],</span>
<span class="sd">            &#39;edge_list&#39;: [(0, 1), (1, 2), (0, 3), (3, 4)]},</span>
<span class="sd">           &#39;tokenizer_pattern&#39;: &#39;(a|\\ )&#39;,</span>
<span class="sd">           &#39;graphtransliterator_version&#39;: &#39;0.3.3&#39;}</span>
<span class="sd">          gt = GraphTransliterator.load(settings)</span>
<span class="sd">          gt.transliterate(&#39;aa&#39;)</span>

<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          # can be compacted</span>
<span class="sd">          settings.pop(&#39;onmatch_rules_lookup&#39;)</span>
<span class="sd">          GraphTransliterator.load(settings).transliterate(&#39;aa&#39;)</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dump : Dump Graph Transliterator configuration to Python data types</span>
<span class="sd">        dumps : Dump Graph Transliterator configuration to JSON string</span>
<span class="sd">        loads : Load Graph Transliteration from configuration as a JSON string</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="c1"># combine kwargs with settings</span>
        <span class="k">return</span> <span class="n">GraphTransliteratorSchema</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>

<div class="viewcode-block" id="GraphTransliterator.loads"><a class="viewcode-back" href="../../api.html#graphtransliterator.GraphTransliterator.loads">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">loads</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create GraphTransliterator from JavaScript Object Notation (JSON) string.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        settings</span>
<span class="sd">            JSON settings for GraphTransliterator</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        GraphTransliterator</span>
<span class="sd">            Graph Transliterator</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        .. jupyter-execute::</span>

<span class="sd">          JSON_settings = &#39;&#39;&#39;{&quot;tokens&quot;: {&quot;a&quot;: [&quot;vowel&quot;], &quot; &quot;: [&quot;wb&quot;]}, &quot;rules&quot;: [{&quot;production&quot;: &quot;A&quot;, &quot;prev_classes&quot;: null, &quot;prev_tokens&quot;: null, &quot;tokens&quot;: [&quot;a&quot;], &quot;next_classes&quot;: null, &quot;next_tokens&quot;: null, &quot;cost&quot;: 0.5849625007211562}, {&quot;production&quot;: &quot; &quot;, &quot;prev_classes&quot;: null, &quot;prev_tokens&quot;: null, &quot;tokens&quot;: [&quot; &quot;], &quot;next_classes&quot;: null, &quot;next_tokens&quot;: null, &quot;cost&quot;: 0.5849625007211562}], &quot;whitespace&quot;: {&quot;default&quot;: &quot; &quot;, &quot;token_class&quot;: &quot;wb&quot;, &quot;consolidate&quot;: false}, &quot;onmatch_rules&quot;: [{&quot;prev_classes&quot;: [&quot;vowel&quot;], &quot;next_classes&quot;: [&quot;vowel&quot;], &quot;production&quot;: &quot;,&quot;}], &quot;metadata&quot;: {&quot;author&quot;: &quot;Author McAuthorson&quot;}, &quot;ignore_errors&quot;: false, &quot;onmatch_rules_lookup&quot;: {&quot;a&quot;: {&quot;a&quot;: [0]}}, &quot;tokens_by_class&quot;: {&quot;vowel&quot;: [&quot;a&quot;], &quot;wb&quot;: [&quot; &quot;]}, &quot;graph&quot;: {&quot;node&quot;: [{&quot;type&quot;: &quot;Start&quot;, &quot;ordered_children&quot;: {&quot;a&quot;: [1], &quot; &quot;: [3]}}, {&quot;type&quot;: &quot;token&quot;, &quot;token&quot;: &quot;a&quot;, &quot;ordered_children&quot;: {&quot;__rules__&quot;: [2]}}, {&quot;type&quot;: &quot;rule&quot;, &quot;rule_key&quot;: 0, &quot;accepting&quot;: true, &quot;ordered_children&quot;: {}}, {&quot;type&quot;: &quot;token&quot;, &quot;token&quot;: &quot; &quot;, &quot;ordered_children&quot;: {&quot;__rules__&quot;: [4]}}, {&quot;type&quot;: &quot;rule&quot;, &quot;rule_key&quot;: 1, &quot;accepting&quot;: true, &quot;ordered_children&quot;: {}}], &quot;edge&quot;: {&quot;0&quot;: {&quot;1&quot;: {&quot;token&quot;: &quot;a&quot;, &quot;cost&quot;: 0.5849625007211562}, &quot;3&quot;: {&quot;token&quot;: &quot; &quot;, &quot;cost&quot;: 0.5849625007211562}}, &quot;1&quot;: {&quot;2&quot;: {&quot;cost&quot;: 0.5849625007211562}}, &quot;3&quot;: {&quot;4&quot;: {&quot;cost&quot;: 0.5849625007211562}}}, &quot;edge_list&quot;: [[0, 1], [1, 2], [0, 3], [3, 4]]}, &quot;tokenizer_pattern&quot;: &quot;(a| )&quot;, &quot;graphtransliterator_version&quot;: &quot;1.2.0&quot;}&#39;&#39;&#39;</span>

<span class="sd">          gt = GraphTransliterator.loads(JSON_settings)</span>
<span class="sd">          gt.transliterate(&#39;a&#39;)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        dump : Dump Graph Transliterator configuration to Python data types</span>
<span class="sd">        dumps : Dump Graph Transliterator configuration to JSON string</span>
<span class="sd">        load : Load Graph Transliteration from configuration in Python data types</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
        <span class="c1"># combine kwargs with settings</span>
        <span class="n">_settings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">settings</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">GraphTransliteratorSchema</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_settings</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CoverageTransliterator"><a class="viewcode-back" href="../../api.html#graphtransliterator.CoverageTransliterator">[docs]</a><span class="k">class</span> <span class="nc">CoverageTransliterator</span><span class="p">(</span><span class="n">GraphTransliterator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Subclass of GraphTransliterator that logs visits to graph and on_match rules.</span>

<span class="sd">    Used to confirm that tests cover the entire graph and onmatch_rules.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Initialize from GraphTransliterator</span>
        <span class="n">GraphTransliterator</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Convert  _graph and _onmatch_rules to visit-tracking objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph</span> <span class="o">=</span> <span class="n">VisitLoggingDirectedGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span> <span class="o">=</span> <span class="n">VisitLoggingList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span><span class="p">)</span>

<div class="viewcode-block" id="CoverageTransliterator.clear_visited"><a class="viewcode-back" href="../../api.html#graphtransliterator.CoverageTransliterator.clear_visited">[docs]</a>    <span class="k">def</span> <span class="nf">clear_visited</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear visited flags from graph and onmatch_rules.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="o">.</span><span class="n">clear_visited</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span><span class="o">.</span><span class="n">clear_visited</span><span class="p">()</span></div>

<div class="viewcode-block" id="CoverageTransliterator.check_onmatchrules_coverage"><a class="viewcode-back" href="../../api.html#graphtransliterator.CoverageTransliterator.check_onmatchrules_coverage">[docs]</a>    <span class="k">def</span> <span class="nf">check_onmatchrules_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check coverage of onmatch rules.&quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">onmatch_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onmatch_rules</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">onmatch_rule</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">onmatch_rules</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>  <span class="c1"># data to avoid visited</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">onmatch_rules</span><span class="o">.</span><span class="n">visited</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;On Match Rule </span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">] has not been visited.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span> <span class="n">onmatch_rule</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span> <span class="ow">and</span> <span class="n">raise_exception</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;Missed OnMatchRules: &quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">IncompleteOnMatchRulesCoverageException</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">errors</span></div>

<div class="viewcode-block" id="CoverageTransliterator.check_coverage"><a class="viewcode-back" href="../../api.html#graphtransliterator.CoverageTransliterator.check_coverage">[docs]</a>    <span class="k">def</span> <span class="nf">check_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check coverage of graph and onmatch rules.</span>

<span class="sd">        First checks graph coverage, then checks onmatch rules.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graph</span><span class="o">.</span><span class="n">check_coverage</span><span class="p">(</span>
            <span class="n">raise_exception</span><span class="o">=</span><span class="n">raise_exception</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_onmatchrules_coverage</span><span class="p">(</span><span class="n">raise_exception</span><span class="o">=</span><span class="n">raise_exception</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Michigan State University

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>